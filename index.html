<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Présentation WebSocket - Basile Parent</title>
    <link rel="shortcut icon" href="public/images/icone.png">

    <meta name="description" content="Présentation Websocket">
    <meta name="author" content="Basile Parent">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="public/reveal/css/reveal.css">
    <link rel="stylesheet" href="public/reveal/lib/css/zenburn.css">
    <link rel="stylesheet" href="public/css/index.css">
    <link rel="stylesheet" href="public/css/intro.css">
    <link rel="stylesheet" href="public/css/intro.css">
    <link rel="stylesheet" href="public/css/scene.css">
    <link rel="stylesheet" href="public/css/projet.css">
    <link rel="stylesheet" href="public/css/websocket.css">
    <link rel="stylesheet" href="public/css/synchronisation.css">
    <link rel="stylesheet" href="public/css/popup.css">
    <link rel="stylesheet" href="public/css/spring-boot-sockjs.css">
    <link rel="stylesheet" href="public/css/demo.css">
    <link rel="stylesheet" href="public/css/resultat.css">
    <link rel="stylesheet" href="public/css/sockjs.css">
    <link rel="stylesheet" href="public/css/merci.css">
    
    
</head>
<body data-background-iframe="public/images/bg_ProxiAD_mini.png">
    <div class="reveal">

        <!-- Any section element inside of this container is displayed as a slide -->
        <div class="slides">
            <section id="intro">
                <h1>Faire communiquer 2 navigateurs</h1>
                <h2>
                    Présentation sur les Websockets
                    <br/>avec un peu de Spring Boot dedans
                </h2>

                <video autoplay="true" loop controls>
                    <source src="public/images/websocket_animation.mp4" type="video/mp4" />
                </video>

            </section>

            <section id="presentation">
                <img src="public/images/photo.jpg" id="presentation__avatar" />
                <h1>Basile Parent</h1>
                <div id="presentation__description">
                    <div id="presentation__job">Développeur Web<br/>Scrum Master</div>
                    <div id="presentation__twitter">
                        <img src="public/images/twitter.png" />
                        <span>@basileparent</span>
                    </div>
                    <div id="presentation__malentendant"><img src="public/images/malentendant.png" /></div>
                </div>
                <img id="presentation__logo_proxiad" src="public/images/logo_ProxiAD.png" />
            </section>

            <section>
                <section id="intro_pourquoi">
                    <h1>Pourquoi faire ?</h1>
                    <div id="intro_pourquoi__personnages_1">
                        <div class="fragment"><img src="public/images/illustrations/boss.png" /></div>
                        <div class="fragment"><img src="public/images/illustrations/demande-pote.png" /></div>
                    </div>

                </section>

                <section id="intro_pourquoi_2">
                    <h1>Pourquoi faire ?</h1>
                    <div id="intro_pourquoi__personnages_2">
                        <img src="public/images/illustrations/demande-pote-courir.png" id="intro_pourquoi__personnages__bg" />
                        <img src="public/images/illustrations/demande-pote-courir-bulle-1.png" id="intro_pourquoi__personnages__bulle_1" class="intro_pourquoi__personnages__bulle fragment" />
                        <img src="public/images/illustrations/demande-pote-courir-bulle-2.png" id="intro_pourquoi__personnages__bulle_2" class="intro_pourquoi__personnages__bulle fragment" />
                        <img src="public/images/illustrations/demande-pote-courir-bulle-3.png" id="intro_pourquoi__personnages__bulle_3" class="intro_pourquoi__personnages__bulle fragment" />
                    </div>
                </section>
            </section>

            <section id="projet_ppt">
                <img src="public/images/illustrations/impro-diapo-ppt.jpg" />
            </section>

            <section id="scene_impro">
                <h1>Le projet</h1>
                <div id="scene_impro__illustration">
                    <img src="public/images/illustrations/regie-projo-bg.png" id="scene_impro__illustration__bg" />
                    <img src="public/images/illustrations/regie-projo-step-1.png" id="intro_pourquoi__personnages__step_1" class="fragment" />
                    <img src="public/images/illustrations/regie-projo-step-2.png" id="intro_pourquoi__personnages__step_2" class="fragment" />
                </div>
            </section>

            <section>
                <section id="projet_prerequis">
                    <h1>Prérequis</h1>
                    <ul>
                        <li>2 interfaces distinctes : régie - spectateur</li>
                        <li>Les 2 interfaces communiquent en temps réel</li>
                        <li>Facilement paramétrable (back-office)</li>
                        <li>Avoir un enchaînement précis d’écrans : <br/>intro, vidéo de présentation, liste des catégories, catégorie, remerciements, prochaines dates</li>
                    </ul>
                </section>

                <section id="projet_prerequis_supplémentaires">
                    <h1>Prérequis</h1>
                    <ul>
                        <li>Sessions conservées</li>
                        <li>Facilement déployable sur n’importe quel PC portable Windows</li>
                        <li>Quelques idées d’évolutions :
                            <ul>
                                <li>Faire tourner sur un Raspberry</li>
                                <li>Le présentateur dirige tout depuis une tablette</li>
                            </ul>
                        </li>
                    </ul>
                </section>
            </section>

            <section id="projet_technologies">
                <h1>Les technologies</h1>

                <main>
                    <div id="projet_technologies__front" class="fragment">
                        <h2>Front</h2>
                        <img src="public/images/icon_js.png" />
                        <img src="public/images/icon_jquery.png" />
                    </div>

                    <div id="projet_technologies__back" class="fragment">
                        <h2>Back</h2>
                        <img src="public/images/icon_php.png" />
                        <img src="public/images/icon_mysql.png" />
                    </div>
                </main>
            </section>

            <section>
                <section id="communication_ajax">
                    <h1>La communication en temps réel</h1>
                    <h2>Ajax Polling</h2>

                    <main>
                        <img src="public/images/ajax_polling.gif" />
                    </main>
                </section>


                <section id="communication">
                    <h1>La communication en temps réel</h1>
                    <h2>Les WebSockets</h2>

                    <main>
                        <img src="public/images/websockets-diagram.png" />
                    </main>
                </section>


                <section id="communication_caniuse">
                    <h1>La communication en temps réel</h1>
                    <h2>Les WebSockets</h2>

                    <main>
                        <ul>
                            <li><figure><img src="public/images/logos/chrome.png" /></figure><span>Chrome 16 + (2011)</span></li>
                            <li><figure><img src="public/images/logos/firefox.png" /></figure><span>Firefox 11 + (2012)</span></li>
                            <li><figure><img src="public/images/logos/ie.png" /></figure><span>IE 10+ (2012)</span></li>
                            <li><figure><img src="public/images/logos/edge.png" /></figure><span>Edge 12 (2015)</span></li>
                            <li><figure><img src="public/images/logos/safari.png" /></figure><span>Safari 7 + (2013)</span></li>
                            <li><figure><img src="public/images/logos/opera.png" /></figure><span>Opera 12.1 + (2012)</span></li>
                            <li><figure><img src="public/images/logos/ios.png" /></figure><span>iOS Safari 6.0 + (2013)</span></li>
                            <li><figure><img src="public/images/logos/android.png" /></figure><span>Android 4.4 + (2013)</span></li>
                            <li><figure><img src="public/images/logos/blackberry.png" /></figure><span>Blackberry 7 + (2012)</span></li>
                        </ul>
                    </main>
                </section>

                <section id="communication_pro_cons">
                    <h1>La communication en temps réel</h1>
                    <h2>Les WebSockets</h2>

                    <table>
                        <thead>
                            <tr>
                                <th class="avantage">Avantages</th>
                                <th class="inconvenient">Inconvénients</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="avantage">Cross plateforme (Web, desktop, mobile)</td>
                                <td class="inconvenient">Pas de fonction de retour comme en Ajax</td>
                            </tr>
                            <tr>
                                <td class="avantage">Pas d'entête HTTP</td>
                                <td class="inconvenient">A besoin d'un serveur pour fonctionner</td>
                            </tr>
                            <tr>
                                <td class="avantage">Plus rapide que l'AJAX</td>
                                <td nclass="inconvenient">Besoin de réfléchir à sa "stratégie" de communication</td>
                            </tr>
                            <tr>
                                <td class="avantage">Le serveur connait ses clients actifs</td>
                                <td class="inconvenient"></td>
                            </tr>
                            <tr>
                                <td class="avantage">Compatible avec tous les navigateurs récents</td>
                                <td class="inconvenient">Compatible avec tous les navigateurs <span class="important">récents</span></td>
                            </tr>
                        </tbody>
                    </table>

                    <aside class="notes">
                        <div style="font-size : 20px;">
                            <table style="border-collapse : collapse;">
                                <thead>
                                    <tr>
                                        <th class="avantage" style="border-bottom : 1px solid black;">Avantages</th>
                                        <th class="inconvenient" style="border-bottom : 1px solid black;">Inconvénients</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="avantage" style="border-bottom : 1px solid black;">
                                            Implémenté par la plupart des navigateurs
                                        </td>
                                        <td class="inconvenient" style="border-bottom : 1px solid black;">
                                            Donc pas de Promise par exemple
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="avantage" style="border-bottom : 1px solid black;">

                                        </td>
                                        <td class="inconvenient" style="border-bottom : 1px solid black;">
                                            Qui dit serveur dit maintenance du serveur, gestion de la charge, etc.
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="avantage" style="border-bottom : 1px solid black;">
                                            Proche d'une communication TCP (sauf la connexion = HTTP)
                                        </td>
                                        <td class="inconvenient" style="border-bottom : 1px solid black;"></td>
                                    </tr>
                                    <tr>
                                        <td class="avantage" style="border-bottom : 1px solid black;">
                                            Contrairement à l'AJAX, on sait qui est connecté
                                        </td>
                                        <td class="inconvenient" style="border-bottom : 1px solid black;"></td>
                                    </tr>
                                    <tr>
                                        <td class="avantage" style="border-bottom : 1px solid black;"></td>
                                        <td class="inconvenient" style="border-bottom : 1px solid black;">
                                            Même si on sait maintenant que Chrome a 60% de parts de marché,
                                            il se peut selon le projet qu'on ait besoin d'étendre l'utilisation à
                                            des navigateurs non compatibles (IE < 10)
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </aside>
                </section>
            </section>

            <section>
                <section id="websocket_api">
                    <h1>API WebSocket</h1>
                    <table>
                        <thead>
                            <tr>
                                <th>Méthodes</th>
                                <th>Événements</th>
                                <th>Attributs</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>void send()</td>
                                <td>onOpen</td>
                                <td>readyState</td>
                            </tr>
                            <tr>
                                <td>void close()</td>
                                <td>onMessage</td>
                                <td>url</td>
                            </tr>
                            <tr>
                                <td> </td>
                                <td>onError</td>
                                <td>protocole</td>
                            </tr>
                            <tr>
                                <td> </td>
                                <td>onClose</td>
                                <td>...</td>
                            </tr>
                        </tbody>
                    </table>

                    <pre><code class="hljs" data-trim contenteditable>
let socket = null;
try {
    socket = new WebSocket("ws://localhost", "protocoleOne");
} catch (exception) {
    console.error(exception);
}

socket.onopen = (event) => { socket.send("Hello world!"); };
socket.onmessage = (event) => { console.log("Message:", event.data); };
socket.onerror = (error) => { console.error(error); };
socket.onclose = (event) => { console.log("Connexion terminé."); };
                        </code></pre>

                    <aside class="notes">
                        <div style="font-size : 20px;">
                            <p>readyState = CONNECTING, OPEN, CLOSING, CLOSED</p>
                            <p>"protocoleOne" : sous-protocoles négociés avec le serveur</p>
                            <p>Attributs supplémentaires : binaryType, bufferedAmount et extensions</p>
                        </div>
                    </aside>
                </section>

                <section id="websocket_switch">
                    <h1>API WebSocket</h1>

                    <div>
                        <div id="websocket_switch__client">
                            <h2>Client JS (émetteur)</h2>
                            <pre><code class="hljs" data-trim contenteditable>
const message = JSON.stringify({
    type: "message",
    value: "Hello World!"
});

websocket.send(message);
                            </code></pre>
                            <h2>Client JS (récepteur)</h2>
                            <pre><code class="hljs" data-trim contenteditable>
socket.onmessage = (event) => {
    const data = JSON.parse(event.data);

    switch (data.type) {
        case "message" :
            // Do something
        case "nextStep" :
            // Do something
        [...]
    }

};
                            </code></pre>
                        </div>
                        <div id="websocket_switch__serveur">
                            <h2>Serveur PHP</h2>
                            <pre><code class="hljs" data-trim contenteditable>
protected function process($user, $json_message) {
    try {
        $json_obj = json_decode_utf8($json_message);
        switch ($json_obj->type) {
            case "message" :
                // Do something
            case "nextStep" :
                // Do something
        }
    }
}
                            </code></pre>
                        </div>
                    </div>

                    <aside class="notes">
                        <div style="font-size : 20px;">
                            <p>
                                Gros défaut de l’API WebSocket : permet uniquement d’envoyer un message sous forme de chaîne de caractères
                                (ou un objet JSON stringifié) sans différenciation de type de message ou de finalité.
                                Du coup, pour différencier le type d’action  :
                                <ul>
                                    <li>soit créer N connexions à N instances de serveur (impensable)</li>
                                    <li>soit coder une classe Message qui contient le type d’action afin de pouvoir trier avec un switch</li>
                                </ul>
                            </p>
                        </div>
                    </aside>
                </section>

                <section id="socketio_methods">
                    <h1>Socket IO</h1>
                    <p>Résoud les problèmes de compatibilité navigateur via différentes méthodes : </p>
                    <ul>
                        <li>WebSocket</li>
                        <li>Adobe Flash Socket</li>
                        <li>AJAX long polling</li>
                        <li>AJAX multipart streaming</li>
                        <li>Forever Iframe</li>
                        <li>JSONP Polling</li>
                    </ul>
                    <aside class="notes">
                        <div style="font-size : 20px;">
                            <p>La version 1.0.0 est sortie en 2014</p>
                            <p>Librairie utilisée par Slack</p>
                            <p>
                                S'interface plus facilement avec le serveur.
                                Par exemple, Node a un module SocketIO qui permet de faire un serveur très rapidement.
                            </p>
                        </div>
                    </aside>
                </section>

                <section id="socketio_compatibility">
                    <h1>Socket IO</h1>
                    <p>Navigateurs compatibles</p>
                    <ul>
                        <li>Internet Explorer 5.5+ (1999)</li>
                        <li>Safari 3+ (2007)</li>
                        <li>Firefox 3+ (2008)</li>
                        <li>Google Chrome 4+ (2010)</li>
                        <li>Opera 10.61+ (2010)</li>
                        <li>Safari sur iPhone et iPad</li>
                        <li>Le navigateur Android</li>
                    </ul>
                </section>

                <section id="socketio_code">
                    <h1>Socket IO</h1>
                    <pre><code class="hljs" data-trim contenteditable><script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io.connect('http://localhost:2021');

    socket.on('message', message => {
        alert('Le serveur a un message pour vous : ' + message);
    });
    socket.on('nextStep', message => {
        alert('Go to next step');
    });

    socket.emit('message', 'Hello world!');
    socket.emit('nextStep', '');
</script>
                    </code></pre>
                </section>

                <aside class="notes">
                    <div style="font-size : 20px;">
                        <p>
                            Inconvénient : on réutilise le protocole HTTP pour ajouter des metadatas :
                            le type de paquet, le namespace et un id de message. Les clients WebSockets
                            natifs ne peuvent pas se connecter à un serveur Socket IO.
                        </p>
                    </div>
                </aside>
            </section>

            <section>
                <h1>Le serveur PHP</h1>

                <pre><code class="hljs" data-trim contenteditable>use Workerman\Worker;
use PHPSocketIO\SocketIO;

$io = new SocketIO(2021);
$io->on('connection', function($socket) {
    $socket->on('message', function ($data)use($socket){
        $socket->emit('message_received', $data);
        $socket->broadcast->emit('message', $data);
    });
    $socket->on('nextStep', function ($data)use($socket){
        // Do something
    });
});

Worker::runAll();
                </code></pre>

                <pre><code class="hljs" data-trim contenteditable>php server.php start</code></pre>

                <aside class="notes">
                    <div style="font-size : 20px;">
                        <p>Côté PHP 2 méthodes :.</p>
                        <ul>
                            <li>Emit qui envoie un message à l'émetteur</li>
                            <li>Broadcast qui envoie un message à tout le monde SAUF l'émetteur</li>
                        </ul>
                        <p>
                            Sur Node.js, il y a une méthode supplémentaire <code>"io.sockets.emit"</code>
                            qui envoie à tout le monde y compris l'émetteur
                        </p>
                    </div>
                </aside>
            </section>


            <section id="code_example_php">
                <h1>Exemple de code pour mon projet</h1>

                <div>
                    <div id="code_example_php__client">
                        <h2 id="code_example_php__client__regie">Émetteur (régie)</h2>
                        <pre><code class="hljs" data-trim contenteditable>const socket = io.connect('http://localhost:2021');

const selectPicture = (idPicture) =>
    socket.emit('selectPicture', { id : idPicture } ));
                        </code></pre>

                        <h2 id="code_example_php__client__spectateur">Récepteur (spectateur)</h2>
                        <pre><code class="hljs" data-trim contenteditable>const socket = io.connect('http://localhost:2021');

socket.on('selectPicture', jsonData => {
        document.getElementById(`picture_${ jsonData.id }`)
            .classList.add("selected");
});
                        </code></pre>
                    </div>
                    <div id="code_example_php__server">
                        <h2>Serveur PHP</h2>
                        <pre><code class="hljs" data-trim contenteditable>use Workerman\Worker;
use PHPSocketIO\SocketIO;

$io = new SocketIO(2021);
$io->on('connection', function($socket) {
    $socket->on('selectPicture',
        function ($data)use($socket) {
            // Database update
            $socket->broadcast
                   ->emit('selectPicture', $data);
        });
});

Worker::runAll();
                        </code></pre>
                    </div>
                </div>
            </section>

            <section>
                <section id="synchronisation_1">
                    <h1>La synchronisation</h1>
                    <h2>Comment garder toutes les interfaces synchronisées</h2>

                    <figure id="synchronisation_1__illustration">
                        <img src="public/images/illustrations/synchronisation-1-step-1.png" class="fragment" />
                        <img src="public/images/illustrations/synchronisation-1-step-2.png" class="fragment" />
                        <img src="public/images/illustrations/synchronisation-1-step-3.png" class="fragment" />
                    </figure>

                </section>

                <section id="synchronisation_2">
                    <h1>La synchronisation</h1>
                    <h2>Comment garder toutes les interfaces synchronisées</h2>

                    <figure id="synchronisation_2__illustration">
                        <img src="public/images/illustrations/synchronisation-2-step-1.png" class="fragment" />
                        <img src="public/images/illustrations/synchronisation-2-step-2.png" class="fragment" />
                        <img src="public/images/illustrations/synchronisation-2-step-3.png" class="fragment" />
                    </figure>

                </section>

                <section id="synchronisation_fail">
                    <h1>La synchronisation</h1>
                    <h2>En cas de problème serveur</h2>

                    <div id="synchronisation_fail__illustration">
                        <div class="synchronisation__solution">
                            <h3>Solution 1</h3>
                            <figure>
                                <img src="public/images/illustrations/synchronisation-1-fail-step-1.png" />
                                <img src="public/images/illustrations/synchronisation-1-fail-step-2.png" class="fragment" />
                            </figure>
                        </div>
                        <div class="synchronisation__solution">
                            <h3>Solution 2</h3>
                            <figure>
                                <img src="public/images/illustrations/synchronisation-2-fail-step-1.png" />
                                <img src="public/images/illustrations/synchronisation-2-fail-step-2.png" class="fragment" />
                            </figure>
                        </div>
                    </div>

                </section>



                <section id="synchronisation_hybride">
                    <h1>La synchronisation</h1>
                    <h2>Solution hybride</h2>

                    <figure id="synchronisation_3__illustration">
                        <img src="public/images/illustrations/synchronisation-3-step-1.png" class="fragment" />
                        <img src="public/images/illustrations/synchronisation-3-step-2.png" class="fragment" />
                        <img src="public/images/illustrations/synchronisation-3-step-3.png" class="fragment" />
                        <img src="public/images/illustrations/synchronisation-3-step-4-fail.png" class="fragment" />
                    </figure>

                    <aside class="notes">
                        <div style="font-size : 20px;">
                            Si un message se perd, aucun moyen pour le client de le savoir.
                            Obligé de faire un timeout pour chaque message...
                        </div>
                    </aside>
                </section>
            </section>

            <section>
                <section id="resultat_ok">
                    <h1>Le résultat</h1>

                    <figure>
                        <img id="resultat_ok__wamp" class="fragment" src="public/images/visuels_application/wamp-vert.png" />
                        <img id="resultat_ok__ws_server" class="fragment" src="public/images/visuels_application/php-ws-server-ready.jpg" />
                        <img id="resultat_ok__application" class="fragment" src="public/images/visuels_application/application-ok.jpg" />
                    </figure>

                </section>


                <section id="resultat_ko">
                    <h1>Le résultat</h1>

                    <figure>
                        <img id="resultat_ko__wamp" class="fragment" src="public/images/visuels_application/wamp-orange.jpg" />
                        <img id="resultat_ko__ws_server" class="fragment" src="public/images/visuels_application/php-ws-server-error.jpg" />
                        <img id="resultat_ko__application" class="fragment" src="public/images/visuels_application/error-404.jpg" />
                    </figure>
                </section>
            </section>




            <section id="solution_popup">
                <section id="solution_popup__illustration">
                    <h1>Une autre solution</h1>
                    <h2>La bonne vieille popup</h2>

                    <figure>
                        <img src="public/images/illustrations/popup.png" />
                    </figure>
                </section>

                <section id="solution_popup__synchronisation">
                    <h1>Une autre solution</h1>
                    <h2>La bonne vieille popup</h2>

                    <h3>Stratégie ?</h3>
                    <div class="solution_popup__h2_strategie fragment">
                        <div>
                            <p>Régie → Spectateur</p>
                            <p>Spectateur → Régie</p>
                        </div>
                    </div>
                    <div class="solution_popup__h2_strategie fragment">
                        <div>
                            <p> </p>
                            <p>Plus stable (graphiquement)</p>
                        </div>
                    </div>

                    <aside class="notes">
                        <div style="font-size : 20px;">
                            <p>
                                Plus stable graphiquement car si la régie plante, on peut la rouvrir discrèetement
                                sans perturber les spectateurs. Si le spectateur est l'enfant de la régie, alors
                                on doit fermer l'onglet Spectateur, refresh la régie puis rouvrir le spectateur
                            </p>
                            <p>
                                Si la connexion se perd avec la popup, aucun moyen de la retrouver.
                            </p>
                        </div>
                    </aside>
                </section>

                <section id="solution_popup__pro_cons">
                    <h1>Une autre solution</h1>
                    <h2>La bonne vieille popup</h2>

                    <table>
                        <thead>
                            <tr>
                                <th class="avantage">Avantages</th>
                                <th class="inconvenient">Inconvénients</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="avantage">Cross-origin</td>
                                <td class="inconvenient">Peut être bloqué par le navigateur</td>
                            </tr>
                            <tr>
                                <td class="avantage">Supporté par la plupart des navigateurs</td>
                                <td class="inconvenient">Manque de stabilité</td>
                            </tr>
                            <tr>
                                <td class="avantage">Pas besoin de serveur</td>
                                <td class="inconvenient">Forcément sur le même ordinateur</td>
                            </tr>
                            <tr>
                                <td class="avantage">Sérialisation des objets</td>
                                <td class="inconvenient"></td>
                            </tr>
                        </tbody>
                    </table>

                    <aside class="notes">
                        <div style="font-size : 20px;">
                            <p>ça me bloquait sur mes idées d’évolutions : pas de possibilité d’appareil tierce et moins
                                d’intérêt à l’héberger sur un Raspberry car il faudra toujours un clavier et une souris.
                            </p>
                        </div>
                    </aside>

                </section>

                <section id="solution_popup__mais">
                    <img src="public/images/php.jpg" />
                </section>

            </section>


            <section>
                <img src="public/images/restart.gif" />
                <aside class="notes">
                    <div style="font-size : 20px;">
                        <p>On efface tout et on recommence.</p>
                        <p>Repartir sur du Java mais problème : installer un serveur Apache + un serveur Mysql
                            tout en étant sûr des paramétrages installés (le driver, le port, tout ça).</p>
                    </div>
                </aside>
            </section>

            <section>
                <section id="spring_boot">
                    <h1>Spring Boot</h1>

                    <ul>
                        <li>Serveur Tomcat intégré</li>
                        <li>Base de données H2 en mode file</li>
                        <li>Dépendance Spring pour les WebSockets</li>
                        <li>Uniquement la JRE 8 à installer</li>
                    </ul>

                    <aside class="notes">
                        <div style="font-size : 20px;">
                            <p>V1 sortie en 2014</p>
                            <p>ça résoud tous mes problèmes de simplicité de déploiement. L’archive JAR embarque un serveur Tomcat, </p>
                            <p>Tout ce qu’il y a à installer sur le poste utilisateur c’est Java 8, ce qui est assez simple.</p>
                        </div>
                    </aside>
                </section>

                <section id="sockjs__java__config">
                    <h1>Spring Boot</h1>
                    <h2>Configuration WS</h2>

                    <pre><code class="hljs" data-trim contenteditable>
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-websocket</artifactId>
</dependency>
                    </code></pre>
                    <pre><code class="hljs" data-trim contenteditable>
@Configuration
@EnableWebSocketMessageBroker
public class WebSocketConfig implements WebSocketMessageBrokerConfigurer {

    @Override
    public void registerStompEndpoints(StompEndpointRegistry registry) {
        registry.addEndpoint("/my-websocket-app").withSockJS();
    }

    @Override
    public void configureMessageBroker(MessageBrokerRegistry config) {
        config.setApplicationDestinationPrefixes("/app");
        config.enableSimpleBroker("/topic");
    }

}
                    </code></pre>

                </section>

                <section id="sockjs__js">
                    <h1>Javascript</h1>
                    <h2>Stomp + Sock JS</h2>

                    <pre><code class="hljs" data-trim contenteditable>
<script src="/path/to/sockjs.js"></script>
<script src="/path/to/stomp.js"></script>

const socket = new SockJS('http://localhost/my-websocket-app');
const stompClient = Stomp.over(socket);

stompClient.connect({}, frame => {
    console.log('Connected: ' + frame);

    stompClient.send("/app/selectPicture/1", {}, "");
    stompClient.send("/app/selectCategory", {}, JSON.stringify({'name' : 'toto'}));
});
                    </code></pre>

                    <aside class="notes">
                        <div style="font-size : 20px;">
                            <p>
                                Stomp est une surcouche légère du protocole Websocket qui résoud quelques problèmes d'encodage
                                et défini quelques méthodes supplémentaires. C'est le protocol que Spring prend en charge.
                            </p>
                        </div>
                    </aside>
                </section>

                <section id="sockjs__java__controller">
                    <h1>Spring Boot</h1>
                    <h2>Controller WebSocket</h2>

                    <pre><code class="hljs" data-trim contenteditable>
    @MessageMapping("/selectPicture/{pictureId}")
    @SendTo("/topic/selectPicture")
    public PictureDto selectPicture(@DestinationVariable Integer pictureId) {
        // Database update
        return new PictureDto(pictureId);
    }
                    </code></pre>
                    <pre><code class="hljs" data-trim contenteditable>
    @MessageMapping("/selectCategory")
    @SendTo("/topic/selectCategory")
    public CategoryDto selectPicture(CategoryDto categoryDto) {
        // Database update
        return categoryDto;
    }
                    </code></pre>

                </section>

                <section id="sockjs__js__callback">
                    <h1>Javascript</h1>
                    <h2>Callbacks</h2>

                    <pre><code class="hljs" data-trim contenteditable>
stompClient.subscribe('/topic/selectPicture', jsonData => {
    const pictureId = JSON.parse(jsonData.body).id;
    document.getElementById('picture_${ pictureId }")
            .classList.add("selected");
});

stompClient.subscribe('/topic/selectCategory', categoryDto => {
    const categoryName = JSON.parse(jsonData.body).name;
    loadCategory(categoryName);
});
                    </code></pre>
                </section>


                <section id="sockjs__other_methods__sendtouser">
                    <h1>Autres méthodes</h1>
                    <h2>@SendToUser (via Spring Security)</h2>

                    <pre><code class="hljs" data-trim contenteditable>
@MessageMapping("/message")
@SendToUser("/queue/reply")
public ChatMessage processMessageFromClient(
                        ChatMessage message,
                        Principal principal) throws Exception {

    return message;

}
                    </code></pre>
                    <pre><code class="hljs" data-trim contenteditable>
stompClient.send("/app/user/[myUserId]/message", {}, "message");
                    </code></pre>
                </section>

                <section id="sockjs__other_methods__exception">
                    <h1>Autres méthodes</h1>
                    <h2>@MessageExceptionHandler</h2>

                    <pre><code class="hljs" data-trim contenteditable>
@MessageExceptionHandler
@SendTo("/topic/errors")
public String handleException(Throwable exception) {
    return exception.getMessage();
}
                    </code></pre>
                    <pre><code class="hljs" data-trim contenteditable>
ws.subscribe("/topic/errors", message => {
    alert("Message " + message.body);
});
                    </code></pre>
                </section>

                <section id="sockjs__other_methods__messaging_template">
                    <h1>Autres méthodes</h1>
                    <h2>SimpMessagingTemplate</h2>

                    <pre><code class="hljs" data-trim contenteditable>
@Autowired
private SimpMessagingTemplate msgTemplate;

@MessageMapping("/chats")
public void handleChat(@Payload ChatMessage message) {
    this.msgTemplate.convertAndSend("/queue/chats-" + myCustomIdentifier,
                        message.getMessage());
}

@Schedule(cron="0 0 * * * *")
public void spam() {
    this.msgTemplate.convertAndSend("/queue/all-chats", "Abonnez-vous !!!");
}
                    </code></pre>

                    <aside class="notes">
                        <div style="font-size : 20px;">
                            <p>
                                Cron expression = toutes les heures
                            </p>
                        </div>
                    </aside>
                </section>
            </section>


            <section id="demo_gif">
                <img src="public/images/demo_time.gif" />
            </section>

            <section id="merci">
                <h1>Merci</h1>
            </section>

            <section id="links">
                <ul>
                    <li><a href="https://www.youtube.com/watch?v=5zFd_ZQZ7V0">H. Sablonnière : Le Web multi-écrans en action</a>
                        <br/>
                        Communication sur une seule machine sans serveur (Popup, LocalStorage events, Broadcast Channel)</li>
                    <li><a href="https://start.spring.io/" target="_blank">Spring Initializr</a></li>
                    <li><a href="https://www.youtube.com/watch?v=P55DGb258gY">Devoxx : De zéro à héros avec Spring Boot</a>
                        <br/>
                        Attention : concerne Spring Boot 1</li>
                    <li><a href="https://tech.m6web.fr/benchmarking-websockets-avec-nodejs">TechM6Web : Benchmarking WebSockets</a>
                        <br/>
                        Benchmark, tests de montée en charge, ...
                    </li>
                </ul>
            </section>

        </div>
    </div>

    <script src="public/reveal/lib/js/head.min.js"></script>
    <script src="public/reveal/js/reveal.js"></script>

    <script>

        // More info https://github.com/hakimel/reveal.js#configuration
        Reveal.initialize({
            controls: true,
            progress: true,
            history: true,
            center: true,

            transition: 'concave', // none/fade/slide/convex/concave/zoom

            // More info https://github.com/hakimel/reveal.js#dependencies
            dependencies: [
                { src: 'public/reveal/lib/js/classList.js', condition: function() { return !document.body.classList; } },
                { src: 'public/reveal/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                { src: 'public/reveal/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                { src: 'public/reveal/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
                { src: 'public/reveal/plugin/search/search.js', async: true },
                { src: 'public/reveal/plugin/zoom-js/zoom.js', async: true },
                { src: 'public/reveal/plugin/notes/notes.js', async: true }
            ]
        });

    </script>

</body>
</html>